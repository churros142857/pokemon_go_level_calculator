<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Go 等級計算機</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 500px; margin: auto; }
        input, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { padding: 10px 20px; margin-top: 10px; cursor: pointer; border: none; background-color: #4CAF50; color: white; border-radius: 4px; }
        .progress-container { margin-top: 15px; }
        .progress-label { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9em; color: #555; }
        .progress { width: 100%; background: #eee; border-radius: 10px; margin: 5px 0; overflow: hidden; }
        .progress-bar { height: 20px; background: #4CAF50; width: 0%; border-radius: 10px; transition: width 0.5s; position: relative; }
        #results { margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 8px; border: 1px solid #ddd; }
        .error-message { color: red; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Pokemon Go 等級計算機</h1>

    <label>當前等級:</label>
    <input type="number" id="currentLevel" min="1" max="50" value="1">

    <label>當前 XP (距離下一級):</label>
    <input type="number" id="currentXP" min="0" value="0">

    <label>目標等級:</label>
    <input type="number" id="targetLevel" min="1" max="50" value="50">

    <label>起始日期:</label>
    <input type="date" id="startDate">

    <label>目標日期:</label>
    <input type="date" id="endDate">

    <button onclick="calculate()">計算</button>

    <div id="results">
        <h3>計算結果</h3>
        <div id="resultContent"></div>
    </div>

    <div class="progress-container">
        <div class="progress-label">
            <span id="currentLevelProgressTitle">目前等級進度</span>
            <span id="currentLevelProgressText">0%</span>
        </div>
        <div class="progress">
            <div id="currentLevelProgressBar" class="progress-bar"></div>
        </div>
    </div>
    
    <div class="progress-container">
        <div class="progress-label">
            <span id="overallProgressTitle">總體進度 (至目標等級)</span>
            <span id="overallProgressText">0%</span>
        </div>
        <div class="progress">
            <div id="overallProgressBar" class="progress-bar"></div>
        </div>
    </div>

    <div id="errorMsg" class="error-message"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const xpTable = [
                0, 1000, 3000, 6000, 10000, 15000, 21000, 28000, 36000, 45000,
                55000, 65000, 75000, 85000, 100000, 120000, 140000, 160000, 185000, 210000,
                260000, 335000, 435000, 560000, 710000, 900000, 1100000, 1350000, 1650000, 2000000,
                2500000, 3000000, 3750000, 4750000, 6000000, 7500000, 9500000, 12000000, 15000000, 20000000,
                26000000, 33500000, 42500000, 53500000, 66500000, 82000000, 100000000, 121000000, 146000000, 176000000
            ];

            const today = new Date();
            document.getElementById('startDate').valueAsDate = today;

            const targetDate = new Date(today.getFullYear(), 9, 14);
            document.getElementById('endDate').valueAsDate = targetDate;

            window.calculate = function() {
                const currentLevel = parseInt(document.getElementById('currentLevel').value);
                const currentXP = parseInt(document.getElementById('currentXP').value);
                const targetLevel = parseInt(document.getElementById('targetLevel').value);
                const startDate = new Date(document.getElementById('startDate').value);
                const endDate = new Date(document.getElementById('endDate').value);
                const errorMsg = document.getElementById('errorMsg');
                const resultsDiv = document.getElementById('resultContent');
                
                const currentLevelProgressTitle = document.getElementById('currentLevelProgressTitle');
                const overallProgressTitle = document.getElementById('overallProgressTitle');
                const currentLevelProgressBar = document.getElementById('currentLevelProgressBar');
                const overallProgressBar = document.getElementById('overallProgressBar');
                const currentLevelProgressText = document.getElementById('currentLevelProgressText');
                const overallProgressText = document.getElementById('overallProgressText');

                errorMsg.textContent = '';
                resultsDiv.innerHTML = '';

                if (isNaN(currentLevel) || isNaN(currentXP) || isNaN(targetLevel) || currentLevel < 1 || targetLevel < 1 || currentLevel > 50 || targetLevel > 50) {
                    errorMsg.textContent = "請輸入有效的等級 (1-50) 和經驗值。";
                    return;
                }

                if (targetLevel <= currentLevel) {
                    errorMsg.textContent = "目標等級必須大於當前等級。";
                    return;
                }

                const totalExpAtCurrentLevel = xpTable[currentLevel - 1];
                const totalExpToNextLevel = (currentLevel === 50) ? 0 : xpTable[currentLevel] - xpTable[currentLevel - 1];
                const totalExpToTargetLevel = xpTable[targetLevel - 1];
                const totalCurrentExp = totalExpAtCurrentLevel + currentXP;
                
                if (totalCurrentExp >= totalExpToTargetLevel) {
                    resultsDiv.innerHTML = `恭喜你！你目前的經驗值已經足以達到或超過 ${targetLevel} 級了！`;
                    currentLevelProgressBar.style.width = '100%';
                    overallProgressBar.style.width = '100%';
                    currentLevelProgressText.textContent = '100%';
                    overallProgressText.textContent = '100%';
                    return;
                }

                const totalXPNeeded = totalExpToTargetLevel - totalCurrentExp;
                const timeDiff = endDate - startDate;
                const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

                if (daysLeft < 0) {
                    errorMsg.textContent = "目標日期不能早於起始日期。";
                    return;
                }

                const dailyXP = daysLeft > 0 ? Math.ceil(totalXPNeeded / daysLeft) : totalXPNeeded;
                const excellentThrowsNeeded = Math.ceil(totalXPNeeded / 2000);
                
                // 計算目前等級進度條百分比
                const currentLevelProgressPercent = (totalExpToNextLevel > 0) ? Math.min((currentXP / totalExpToNextLevel) * 100, 100) : 100;
                
                // 計算總體進度條百分比
                const overallProgressPercent = (totalCurrentExp / totalExpToTargetLevel) * 100;

                resultsDiv.innerHTML = `
                    <p><strong>總共需要經驗值:</strong> ${totalXPNeeded.toLocaleString()}</p>
                    <p><strong>距離目標天數:</strong> ${daysLeft} 天</p>
                    <p><strong>每天平均需要經驗值:</strong> ${dailyXP.toLocaleString()}</p>
                    <p><strong>總共需要 Excellent 投擲:</strong> ${excellentThrowsNeeded.toLocaleString()} 次</p>
                `;
                
                currentLevelProgressTitle.textContent = `目前等級進度 (${currentLevel} 級 → ${currentLevel + 1} 級)`;
                overallProgressTitle.textContent = `總體進度 (${currentLevel} 級 → ${targetLevel} 級)`;
                currentLevelProgressBar.style.width = `${currentLevelProgressPercent.toFixed(2)}%`;
                overallProgressBar.style.width = `${overallProgressPercent.toFixed(2)}%`;
                currentLevelProgressText.textContent = `${currentXP.toLocaleString()} / ${(totalExpToNextLevel).toLocaleString()} XP (${currentLevelProgressPercent.toFixed(2)}%)`;
                overallProgressText.textContent = `${totalCurrentExp.toLocaleString()} / ${totalExpToTargetLevel.toLocaleString()} XP (${overallProgressPercent.toFixed(2)}%)`;
            }
        });
    </script>
</body>
</html>
